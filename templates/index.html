<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>即時翻譯系統</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <button class="settings-toggle" id="settingsToggle">⚙️ 隱藏設定</button>
    
    <!-- 簡報模式控制面板 -->
    <div class="presentation-controls" id="presentationControls" style="display: none;">
        <!-- 收縮時顯示的按鈕 -->
        <div class="control-toggle" id="controlToggle">
            <span class="toggle-icon">⚙️</span>
        </div>
        
        <!-- 展開時顯示的完整控制項 -->
        <div class="controls-content" id="controlsContent">
            <div class="font-size-control">
                <button class="control-btn font-btn" id="fontDecrease">A-</button>
                <span id="fontSizeDisplay">28px</span>
                <button class="control-btn font-btn" id="fontIncrease">A+</button>
            </div>
            <div class="control-divider"></div>
            <button class="control-btn exit-btn" id="presentationExitBtn">🚪 退出</button>
        </div>
    </div>
    
    <div class="container" id="container">
        <div class="header" id="header">
            <h1>🗣️ 即時翻譯系統</h1>
            <p>Web Speech API + GPT-4o-mini 驅動</p>
        </div>
        
        <div class="main-content" id="mainContent">
            <div class="api-config" id="apiConfig">
                <label for="apiKey">OpenAI API Key:</label>
                <input type="password" id="apiKey" placeholder="請輸入您的 OpenAI API Key">
                
                <div class="noise-config">
                    <h4>🎤 語音識別設定</h4>
                    
                    <div class="setting-item">
                        <label>
                            <span>🔧 識別引擎:</span>
                            <select id="recognitionEngine" style="margin-left: 10px; padding: 5px;">
                                <option value="webspeech">Web Speech API (瀏覽器內建)</option>
                                <option value="whisper">OpenAI Whisper (更準確)</option>
                            </select>
                        </label>
                        <small>
                            Whisper 需要 OpenAI API Key，準確度更高但會消耗額外費用<br>
                            <strong>遠距離優化：</strong>自動增益、噪音抑制、1.5秒快速識別、音量檢測
                        </small>
                    </div>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="advancedNoiseSuppression" checked>
                            噪音抑制 (適用於吵雜環境)
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="incrementalTranslation" checked>
                            即時增量翻譯 (邊說邊翻譯)
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <label for="confidenceThreshold">識別敏感度:</label>
                        <div class="slider-container">
                            <input type="range" id="confidenceThreshold" min="0.3" max="0.8" step="0.1" value="0.5">
                            <span id="confidenceValue">中等</span>
                        </div>
                        <small>左邊 = 更敏感，右邊 = 更準確</small>
                    </div>
                </div>
            </div>
            
            <div class="controls" id="controls">
                <div class="language-selector">
                    <label>🎯 語音識別:</label>
                    <select id="sourceLanguage">
                        <option value="auto">🔍 自動偵測</option>
                        <option value="zh-TW">繁體中文</option>
                        <option value="en-US">English</option>
                    </select>
                </div>
                
                <div class="language-selector">
                    <label>🌐 翻譯目標:</label>
                    <select id="targetLanguage">
                        <option value="繁體中文">繁體中文</option>
                        <option value="English">English</option>
                    </select>
                </div>
                
                <button id="recordBtn" class="record-btn">檢查狀態</button>
                <button id="presentationBtn" class="record-btn" style="background: linear-gradient(135deg, #17a2b8, #138496);">📺 簡報模式</button>
            </div>
            
            <div class="transcript-container" id="transcriptContainer">
                <div class="transcript-header">
                    <h2>📝 會議實時字幕</h2>
                    <div class="controls-mini">
                        <button id="clearBtn" class="clear-btn">🗑️ 清除</button>
                        <button id="exitPresentationBtn" class="clear-btn" style="background: #17a2b8; display: none;">🚪 退出簡報</button>
                        <span id="wordCount" class="word-count">字數: 0</span>
                    </div>
                </div>
                
                <div class="transcript-display" id="transcriptDisplay">
                    <div class="transcript-item start-message">
                        <div class="timestamp">開始時間</div>
                        <div class="content">
                            <div class="source-text">會議開始，正在等待語音輸入...</div>
                            <div class="translated-text">Meeting started, waiting for voice input...</div>
                        </div>
                    </div>
                </div>
                
                <div class="presentation-pane original-pane" id="originalPane" style="display: none;">
                    <h3>🎯 原文</h3>
                    <div class="presentation-content" id="originalContent">
                        <div class="text-wrapper">等待語音輸入...</div>
                    </div>
                </div>
                
                <div class="presentation-pane translated-pane" id="translatedPane" style="display: none;">
                    <h3>🌐 翻譯</h3>
                    <div class="presentation-content" id="translatedContent">
                        <div class="text-wrapper">等待翻譯結果...</div>
                    </div>
                </div>
                
                <div class="current-speaking" id="currentSpeaking">
                    <div class="speech-status">
                        <div class="live-indicator">🔴 LIVE</div>
                        <div class="confidence-indicator" id="confidenceIndicator">
                            <span class="confidence-label">識別品質:</span>
                            <div class="confidence-bar">
                                <div class="confidence-fill" id="confidenceFill"></div>
                            </div>
                            <span class="confidence-text" id="confidenceText">--</span>
                        </div>
                    </div>
                    <div class="current-text" id="currentText"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>